--- tcia_utils/nbia.py.orig	2023-07-07 15:28:39
+++ tcia_utils/nbia.py	2023-07-07 15:38:09
@@ -1,7 +1,6 @@
 ####### setup
 import logging
 import requests
-import pandas as pd
 import getpass
 import json
 import zipfile
@@ -13,7 +12,6 @@
 import matplotlib.pyplot as plt
 import pydicom
 import numpy as np
-from ipywidgets import interact
 
 class StopExecution(Exception):
     def _render_traceback_(self):
@@ -50,14 +48,14 @@
 def setApiUrl(endpoint, api_url):
     """
     setApiUrl() is used by most other functions to select the correct base URL
-    and is generally not something that needs to be called directly in your code.  
-    
+    and is generally not something that needs to be called directly in your code.
+
     It assists with:
         1. verifying you are calling a supported endpoint
         2. selecting the correct base URL for Search vs Advanced APIs
         3. selecting the correct base URL for regular collections vs NLST
         4. ensuring you have a valid security token where necessary
-    
+
     Learn more about the NBIA APIs at https://wiki.cancerimagingarchive.net/x/ZoATBg
     """
     global searchEndpoints, advancedEndpoints
@@ -108,7 +106,7 @@
                     getToken(user = "nbia_guest", api_url = "nlst")
                 if 'nlst_token_exp_time' in globals() and datetime.now() > nlst_token_exp_time:
                     refreshToken(api_url = "nlst")
-                base_url = "https://nlst.cancerimagingarchive.net/nbia-api/services/"                
+                base_url = "https://nlst.cancerimagingarchive.net/nbia-api/services/"
         elif api_url == "restricted":
             if endpoint in searchEndpoints:
                 # Using "Search with Authentication" API (login required): https://wiki.cancerimagingarchive.net/x/X4ATBg
@@ -146,7 +144,7 @@
 
         return base_url
 
-def getToken(user = "", pw = "", api_url = ""): 
+def getToken(user = "", pw = "", api_url = ""):
     """
     getToken() accepts user and pw parameters to create a token to access APIs that require authorization.
     Access tokens expire 2 hours after creation, and can be refreshed with refreshToken().
@@ -160,7 +158,7 @@
     if api_url == "nlst":
         token_url = "https://nlst.cancerimagingarchive.net/nbia-api/oauth/token"
         userName = "nbia_guest"
-        passWord = ""        
+        passWord = ""
     # specify user/pw unless nbia_guest is being used for accessing Advanced API anonymously
     else:
         token_url = "https://nbia.cancerimagingarchive.net/nbia-api/oauth/token"
@@ -185,7 +183,7 @@
         'username' : userName,
         'password': passWord
         }
-        
+
         data = requests.post(token_url, data = params)
         data.raise_for_status()
         access_token = data.json()["access_token"]
@@ -198,7 +196,7 @@
             nlst_refresh_token = data.json()["refresh_token"]
             _log.info(f'Success - Token saved to nlst_api_call_headers variable and expires at {nlst_token_exp_time}')
         else:
-            token_exp_time = current_time + timedelta(seconds=expires_in)            
+            token_exp_time = current_time + timedelta(seconds=expires_in)
             api_call_headers = {'Authorization': 'Bearer ' + access_token}
             refresh_token = data.json()["refresh_token"]
             _log.info(f'Success - Token saved to api_call_headers variable and expires at {token_exp_time}')
@@ -216,10 +214,10 @@
     """
     refreshToken() refreshes security tokens to extend access time for APIs that require authorization.
     It attempts to verify that a refresh token exists and recommends using getToken() to create a new token if needed.
-    This function is called as needed by setApiUrl() and is generally not something that needs to be called directly in your code.    
+    This function is called as needed by setApiUrl() and is generally not something that needs to be called directly in your code.
     """
     global token_exp_time, nlst_token_exp_time, api_call_headers, nlst_api_call_headers
-   
+
     # token URLs
     if api_url == "nlst":
         try:
@@ -230,7 +228,7 @@
             raise StopExecution
         else:
             token_url = "https://nlst.cancerimagingarchive.net/nbia-api/oauth/token"
-    
+
     else:
         try:
             token = refresh_token
@@ -248,7 +246,7 @@
         'grant_type': 'refresh_token',
         'refresh_token' : token,
         }
-        
+
         # obtain new access token
         data = requests.post(token_url, data = params)
         data.raise_for_status()
@@ -273,8 +271,8 @@
         _log.error(f"Timeout Error: {data.status_code}")
     except requests.exceptions.RequestException as err:
         _log.error(f"Request Error: {data.status_code}")
-            
-def logoutToken(api_url = ""): 
+
+def logoutToken(api_url = ""):
     """
     logoutToken() logs out security tokens used for APIs that require authorization.
     Variables holding access token information are also deleted by this operation.
@@ -289,7 +287,7 @@
         api_call_headers = nlst_api_call_headers
     elif api_url != "nlst" and 'api_call_headers' in globals():
         url = "https://services.cancerimagingarchive.net/nbia-api/logout"
-    else: 
+    else:
         _log.error("Error: You haven't created a token yet, or have already logged out.")
         raise StopExecution
 
@@ -315,14 +313,14 @@
 
 def makeCredentialFile(user = "", pw = ""):
     """
-    Creates a credential file to use with NBIA Data Retriever. 
+    Creates a credential file to use with NBIA Data Retriever.
     Interactive prompts are provided for user/pw if they're not specified as parameters.
     The credential file is a text file that passes the user's credentials in the following format:
         userName = YourUserName
         passWord = YourPassword
         Both parameters are case-sensitive.
     Additional documentation:
-        https://wiki.cancerimagingarchive.net/x/2QKPBQ 
+        https://wiki.cancerimagingarchive.net/x/2QKPBQ
         https://github.com/kirbyju/TCIA_Notebooks/blob/main/TCIA_Linux_Data_Retriever_App.ipynb
     """
     # set user name and password
@@ -396,7 +394,7 @@
         _log.error(errt)
     except requests.exceptions.RequestException as err:
         _log.error(err)
-    
+
 
 def getCollections(api_url = "",
                    format = ""):
@@ -822,7 +820,7 @@
 
     # get base URL
     base_url = setApiUrl(endpoint, api_url)
-    
+
     # if input = manifest convert manifest to python list of uids
     if input_type == "manifest":
         series_data = manifestToList(series_data)
@@ -1182,7 +1180,7 @@
 
     data = queryData(endpoint, options, api_url, format)
     return data
-    
+
 ####### getSegRefSeries function (Advanced)
 # Gets DICOM tag metadata for a given SEG/RTSTRUCT series UID (scan)
 # and then look up the series UID they were derived from
@@ -1208,7 +1206,7 @@
                 # Retrieve the value of "Series Instance UID" from the next row
                 refSeriesUid = df.loc[index + 1, 'data']
                 return refSeriesUid
-            
+
             else:
                 print("Segmentation doesn't contain a reference series UID.")
                 refSeriesUid = "N/A"
@@ -1226,7 +1224,7 @@
                 # Retrieve the value of "Series Instance UID" from the next row
                 refSeriesUid = df.loc[index + 1, 'data']
                 return refSeriesUid
-            
+
             else:
                 print("Segmentation doesn't contain a reference series UID.")
                 refSeriesUid = "N/A"
@@ -1471,7 +1469,7 @@
 # Specify input_type = "manifest" to ingest a *.TCIA manifest file or "list" for a python list of UIDs
 # If input_type = "manifest" or "list" and there are series UIDs that are restricted
 #    you must call getToken() with a user ID that has access to all UIDs before calling this function.
-# Specifying api_url is only necessary if you are using input_type = "manifest" or "list" with NLST data (e.g. api_url = "nlst") 
+# Specifying api_url is only necessary if you are using input_type = "manifest" or "list" with NLST data (e.g. api_url = "nlst")
 # Specify format = "var" to return the report values as a dictionary
 # Access variables example after saving function output to report_data: subjects = report_data["subjects"]
 # Specify format = "file" to save the report to a file
@@ -1490,7 +1488,7 @@
     # if input_type is manifest convert it to a list
     if input_type == "manifest":
         series_data = manifestToList(series_data)
-        
+
     # if input_type is a list or manifest download relevant metadata
     if input_type == "list" or input_type == "manifest":
         df = getSeriesList(series_data, api_url = "", csv_filename = "")
@@ -1663,6 +1661,7 @@
     Leave seriesUid empty if you want to provide a custom path.
     The function assumes "tciaDownload/<seriesUid>/" as path if seriesUid is provided since this is where downloadSeries() saves data.
     """
+    from ipywidgets import interact
     # set path where downloadSeries() saves the data if seriesUid is provided
     if seriesUid != "":
         path = "tciaDownload/" + seriesUid
