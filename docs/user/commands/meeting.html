<html>

<!--
=== UCSF ChimeraX Copyright ===
Copyright 2016 Regents of the University of California.
All rights reserved.  This software provided pursuant to a
license agreement containing restrictions on its disclosure,
duplication and use.  For details see:
http://www.rbvi.ucsf.edu/chimerax/docs/licensing.html
This notice must be embedded in or attached to all copies,
including partial copies, of the software or any revisions
or derivations thereof.
=== UCSF ChimeraX Copyright ===
-->

<head>
<link rel="stylesheet" type="text/css" href="../userdocs.css" />
<title>Command: meeting</title>
</head><body>

<a name="top"></a>
<a href="../index.html">
<img width="60px" src="../ChimeraX-docs-icon.svg" alt="ChimeraX docs icon"
class="clRight" title="User Guide Index"/></a>

<h3><a href="../index.html#commands">Command</a>: meeting</h3>

<h3 class="usage"><a href="usageconventions.html">Usage</a>:
<br><b>meeting</b> &nbsp;<b>start</b>&nbsp;
[&nbsp;<a href="#options"><b>name</b></a>&nbsp;&nbsp;<i>participant-name</i>&nbsp;]
[&nbsp;<a href="#options"><b>color</b></a>&nbsp;&nbsp;<i>pointer-color</i>&nbsp;] 
[&nbsp;<a href="#options"><b>faceImage</b></a>&nbsp;&nbsp;<i>image-file</i>&nbsp;] 
[&nbsp;<a href="#start-options"><b>proxy</b></a>&nbsp;&nbsp;<i>proxy-host</i>&nbsp;]
[&nbsp;<a href="#start-options"><b>keyForProxy</b></a>&nbsp;&nbsp;<i>ssh-identity-file</i>&nbsp;]
[&nbsp;<a href="#start-options"><b>copyScene</b></a>&nbsp;&nbsp;<b>true</b>&nbsp;|&nbsp;false&nbsp;]
<span class="nowrap">&nbsp;<a href="#options"><i>other-options</i></a></a>
</h3>
<h3 class="usage"><a href="usageconventions.html">Usage</a>:
<br><b>meeting</b> &nbsp;<i>host</i>&nbsp;
[&nbsp;<a href="#options"><b>name</b></a>&nbsp;&nbsp;<i>participant-name</i>&nbsp;]
[&nbsp;<a href="#options"><b>color</b></a>&nbsp;&nbsp;<i>pointer-color</i>&nbsp;] 
[&nbsp;<a href="#options"><b>faceImage</b></a>&nbsp;&nbsp;<i>image-file</i>&nbsp;] 
<span class="nowrap">&nbsp;<a href="#options"><i>other-options</i></a></a>
</h3>
<h3 class="usage"><a href="usageconventions.html">Usage</a>:
<br><b>meeting</b> &nbsp;<b>send</b>
</h3>
<h3 class="usage"><a href="usageconventions.html">Usage</a>:
<br><b>meeting</b> &nbsp;<b>close</b>
</h3>
<p>
The <b>meeting</b> command shares a scene between
two or more ChimeraX instances running on different computers.
Its main purpose is to allow multi-person
<a href="../vr.html">virtual reality</a> (VR) sessions in ChimeraX.
It can also be used without VR, but in that case, 
a desktop screen-sharing program may be a more reliable alternative.
Each participant is represented by an image and 
hand-controller pointers (or if not using VR, the mouse pointer)
so that participants can see each other pointing at objects in the scene.
For non-VR participants, the camera view is synchronized, but
the cone indicating the mouse pointer position of a non-VR user
is only displayed to others when the user pauses the mouse over a model,
as for picking.
</p><p>
The computer that started the meeting must be reachable over the 
network by the other participants. Firewalls can block the connection;
see <a href="#firewalls">getting around firewalls</a> below.
See also: <a href="device.html#vr"><b>vr</b></a>
</p><p>
The meeting is initiated with <b>meeting start</b>, which reports the 
hostname and IP address in the <a href="../tools/log.html"><b>Log</b></a>.
Subsequently, others join using <b>meeting</b> <i>host</i>,
where <i>host</i> is the hostname or IP address of the starting instance
(<i>e.g.</i>, <b>descartes.cgl.ucsf.edu</b> or <b>169.230.21.39</b>).
</p><p>
Each participant can specify a <b>name</b> to serve as an identifier 
within the shared environment, a <b>faceImage</b> file, 
and a pointer-cone <b>color</b>.
</p><p>
Aside from synchronizing pointers, the <b>meeting</b> command will 
<a href="#options">copy</a>
a session from the ChimeraX instance that initiates the meeting 
to each person who joins the meeting.
This copying is done only when a person joins the meeting. 
Commands executed by one participant will automatically execute for the others
(by <a href="#relayCommands">default</a>),
and if a participant using VR moves the scene,
others using VR will see the motion.
Participants not using VR maintain their own viewing directions.
If unshared changes have been made, a participant can still share 
his current scene with the others by using <b>meeting send</b>.
The host can end the meeting with <b>meeting close</b>, or
others can use it to exit the meeting individually.
</p><p>
The <b>meeting</b> command is under development 
and has several <a href="#limitations">limitations</a>.
</p>

<a name="start-options"></a>
<p class="nav">
[<a href="#top">back to top: meeting</a>]
</p>
<h3>Meeting Start Options</h3>

<blockquote>
<a name="proxy"></a>
<b>proxy</b> &nbsp;<i>proxy-host</i>
<br>
User and host name for a proxy server, for example,
<b>chimerax@13.56.160.227</b>.
An ssh tunnel is made to the proxy server so that participants can connect to
the proxy when the meeting host is not directly reachable due to a firewall
(<a href="#useproxy">details...</a>).
The private key for connecting with ssh is provided with the 
<a href="#keyForProxy"><b>keyForProxy</b></a> option.
If the connection to the proxy server fails because the proxy is not reachable,
it takes typically 75 seconds before the ssh connection attempt times out and an
error message is logged. This option can only be used by the meeting host.
</blockquote>
<blockquote>
<a name="keyForProxy"></a>
<b>keyForProxy</b> &nbsp;<i>ssh-identity-file</i>
<br>
The ssh identity file (<i>e.g.</i>, <b>vr-key-private.pem</b>)
used to make an ssh tunnel to the proxy server given with the 
<a href="#proxy"><b>proxy</b></a> option.
Substituting the word <a href="usageconventions.html#browse"><b>browse</b></a>
for the pathname brings up a file browser window for choosing the
file interactively.
This identity file is the private key used to connect to the proxy using
the ssh <i>-i</i> option when creating the tunnel. The file must not
have read permissions by others or ssh will consider it insecure and 
not accept it.
</blockquote>
<blockquote>
<b>copyScene</b> &nbsp;<b>true</b>&nbsp;|&nbsp;false
<br>
Whether to copy the session from the starting instance
to each person who joins the meeting (default <b>true</b>).
This copying is done only when a person joins the meeting. 
</blockquote>

<a name="options"></a>
<p class="nav">
[<a href="#top">back to top: meeting</a>]
</p>
<h3>General Options</h3>
<blockquote>
<b>name</b>&nbsp;&nbsp;<i>participant-name</i>
<br>
Name to show for a participant's pointer and image models
in the <a href="../tools/modelpanel.html"><b>Model Panel</b></a>.
The meeting participant name is remembered as a
<a href="../preferences.html#other">preference</a>
(initial default <b>Remote</b>).
</blockquote>
<blockquote>
<b>color</b>&nbsp;&nbsp;<a href="colornames.html"><i>pointer-color</i></a>
<br>
Color for the cones representing a VR participant's hand-controller pointers
(or non-VR participant's mouse pointer).
The pointer color is remembered as a
<a href="../preferences.html#other">preference</a>
(initial default <b>lime</b>
<table border cellpadding="4" cellspacing="0"
style="display:inline-block; vertical-align:middle"><tr>
<td bgcolor=lime width="10px" title="lime"></td></tr></table>).
</blockquote>
<blockquote>
<b>faceImage</b>&nbsp;&nbsp;<i>image-file</i>
<br>
Image to represent a VR participant's headset position,
where <i>image-file</i> is the pathname of a JPG or PNG file.
The pathname can be absolute or relative to the current working directory as
reported by <a href="pwd.html"><b>pwd</b></a>,
Substituting the word <a href="usageconventions.html#browse"><b>browse</b></a>
for the pathname brings up a file browser window for choosing the
file interactively. The meeting image pathname is remembered as a
<a href="../preferences.html#other">preference</a>.
</blockquote>
<blockquote>
<a name="relayCommands"></a>
<b>relayCommands</b> &nbsp;<b>true</b>&nbsp;|&nbsp;false
<br>
Whether to share <a href="../index.html#commands">commands</a>
with other participants, and in turn, execute other participants' commands 
automatically (default <b>true</b>).
Note that <a href="../index.html#toolbars">toolbar</a> icon buttons and many 
<a href="ui.html#mousemode">mouseclick/pointer operations</a> act via commands.
</blockquote>
<blockquote>
<b>port</b>&nbsp;&nbsp;<i>N</i>
<br>
Number of the network port used to connect to the meeting host
(default <b>52194</b>). Unless the default is used,
all who join the meeting must specify the same number 
as specified with <b>meeting start</b>.
</blockquote>
<blockquote>
<b>updateInterval</b>&nbsp;&nbsp;<i>M</i>
<br>
How often to send a participant's
VR headset and hand-controller positions to the other participants
(every <i>M</i><sup>th</sup> frame, default <b>1</b>, every frame).
</blockquote>

<a name="limitations"></a>
<p class="nav">
[<a href="#top">back to top: meeting</a>]
</p>
<h3>Limitations and Potential Developments</h3>
<p>
<b>Firewalls block connections.</b>
Most academic institutions have firewalls that block incoming network 
connections, and require administrative requests to open up network ports.
See below for how to <a href="#firewalls">get around firewalls</a>.
<!--
Whereas the <b>meeting</b> command only allows running the hub
server on the initiator's local host (and is thus susceptible to being
blocked by participants' firewalls), the
<a href="conference.html"><b>conference</b></a> command
is being developed to allow using a publicly accessible address/port instead.
However,
the <a href="conference.html"><b>conference</b></a> command is not yet working.
To allow this to scale to hundreds of instances running simultaneously,
ChimeraX could start a cloud-based server on demand using a commercial service
that accepts the connections and forwards changes to all participants. 
However, this is a complex undertaking that would require 
accounts and payment for commercial services.
Currently, the
<a href="http://www.cgl.ucsf.edu/Overview/index.html" target="_blank">UCSF
RBVI</a> is providing a hub server for use with the
<a href="conference.html"><b>conference</b></a> command at:
<b>cxconference.rbvi.ucsf.edu:443</b>
-->
</p>

<p>
<b>Synchronizing changes.</b>
After the initial scene is shared not all changes made by one participant will
be propagated to other participants. Changes that are propagated include 
moving and scaling the displayed structures and
(by <a href="#relayCommands">default</a>) 
executing <a href="../index.html#commands">commands</a>.
If a participant makes any unshared changes or
introduces data for which the input file is not directly accessible 
to others (<i>i.e.</i>, the same <a href="open.html"><b>open</b></a>
command will not work for everyone), <b>meeting send</b> 
is needed to share the updated session.
This may be slow for large amounts of data.
</p>

<p>
<b>More than two participants.</b>
The meeting command has had very limited testing with more than two
participants. Multiple participants may cause errors or slow display updating.
</p>

<p>
<b>No audio chat support.</b>
An audio connection is not provided,
so it is necessary to set up a separate audio link for remote participants.
<a href="https://zoom.us">Zoom</a> using the headset speakers and microphone works well.
</p>

<p>
<b>Aligning two VR headsets in one room.</b>
Two Vive or Vive Pro VR headsets can be used in the same room, each connected
to its own computer. Each headset uses the same pair of base stations.
A problem sometimes arises that the two headsets do not see the 
ChimeraX structures displayed at the same location in the room.
Specifically, one headset may see the structure positions 
as if the room is rotated 180&deg; relative to the other headset.
This happens because the SteamVR room setup is run separately on each computer
and produces a different coordinate system. For structures to have the same
room position in both headsets, the room boundaries traced using SteamVR room
setup should be the same for both computers. The first step of SteamVR room
setup in which users are asked to point the hand controller at the screen 
and click is the key to avoiding 180&deg; misorientation. At that step, it
is important to point along the short axis of the 
rectangle defining the room bounds (that will be traced in a later step).
SteamVR chooses between two coordinate system orientations
rotated 180&deg; from each other based on the direction of pointing.
If pointing is along the long axis of the rectangle bounds, a slight tilt 
toward the left or right of the long axis produces opposite coordinate 
system orientations. Pointing along the short axis instead is a reliable
way to make both computers use the same orientation.
(The computer screen position is irrelevant.)
</p>


<a name="firewalls"></a>
<p class="nav">
[<a href="#top">back to top: meeting</a>]
</p>
<h3>Getting Around Firewalls</h3>
<p>
Most universities, colleges, institutions, companies and government labs 
have firewalls that prevent incoming network connections.
When joining a meeting, ChimeraX attempts to connect
to port 52194 on the computer that started the meeting, as indicated
by the message &ldquo;Waiting for scene data from meeting host.&rdquo;
If the connection is blocked, usually after 60 seconds an error message 
will appear:
</p>
<pre style="color:red">
  Socket error Connection timed out
</pre>
<p>
Two ways to resolve the problem are to:
</p>
<ul>
<li>Open port 52194 in the firewall that protects the computer 
that started the meeting to allow incoming connections.
<br>&ndash; OR &ndash;<br>
<li>Set up a proxy virtual machine outside the firewall;
everyone can access the virtual machine and use it to forward 
connections to the computer that started the meeting.
</ul>
<p>
Details on each approach are given below.
</p>

<p><b>Open a firewall port</b><br>
By far the easiest solution is to change the firewall settings protecting
the computer that starts the meeting to allow incoming connections 
on port 52194. Here are two examples of how that can be done:
</p>
<ul>
<li><b>Home network firewall.</b>
If the meeting host is on a home network, a port forwarding rule can be 
added using the home router administration interface.
A home usually has just one internet address visible from the outside,
and a router that
connects all the home devices (computers, phones, tablets, TVs...)
on an internal network.
To allow outside meeting participants to reach the computer on 
the home network:
<ol>
<li>Assign the host computer a static IP address on the home network
(<i>e.g.</i>, 192.168.0.2) &ndash; this is
sometimes called a &ldquo;static lease&rdquo;
<li>Set a port forwarding rule to forward port 52194 to that address
</ol>

<li><b>Institution firewall.</b>
If the computer is behind an institution firewall, it may be possible 
to ask the institution to open the port. For example, 
at the University of California San Francisco, I (Tom Goddard) put in a request
with the Information Technology department to open port 52194
on the campus firewall for connections to my desktop PC.
They opened the port just for this one computer, limiting the security threats. 
It took about 10 days before they processed the request. Some institutions
will not allow these exceptions due to stricter security requirements.
</ul>

<a name="useproxy"></a>
<p><b>Forward connections from a proxy virtual machine</b><br>
If a firewall exception cannot be made, a more difficult solution is to 
set up a virtual machine that is publicly visible on the internet,
for example, using Amazon Web Services (AWS). The AWS machine can
simply accept connections and forward them to the host computer behind the 
institution firewall using an ssh tunnel.
</p><p>
I have used the following procedure to set up an 
AWS virtual machine for ChimeraX meeting access.
This could be done with any cloud virtual machine service
since only ssh is required.
</p>

<ol>
  <li>Create an AWS EC2 virtual machine; I used a free type t2.micro 
using an Ubuntu 18.04 LTS Amazon Machine Image.
The machine will need minimal compute and network bandwidth as it is just 
forwarding data. The only large data being forwarded is the initial 
ChimeraX meeting session. I chose Ubuntu 18.04 only because I have experience 
with it. Any Linux distribution will work, since only ssh will be used.
  <li>Set the virtual machine security group to allow any computer to connect
on port 52194. By default, the virtual machine will not allow connections 
except on ssh port 22, so this is a necessary step.
  <li>Change sshd configuration file on the virtual machine 
/etc/ssh/sshd_config enabling &ldquo;GatewayPorts yes&rdquo;
and restart sshd (on Ubuntu 18, &ldquo;sudo service ssh restart&rdquo;).
This will allow other computers to connect to ssh tunnels.
The normal use of ssh tunnels just allows the local computer use the tunnel,
so this setting change is necessary.
  <li>Create the tunnel using the <a href="#proxy"><b>proxy</b></a> option
when starting the meeting, for example:
<blockquote>
<b>meeting start proxy ubuntu@54.215.157.17 key vr-key-private.pem</b>
</blockquote>
The <a href="#keyForProxy"><b>key</b></a> option specifies
the public key encryption file <b>vr-key-private.pem</b>
that was made when I created the AWS virtual machine. 
It allows ssh access to the virtual machine without typing a password. 
The &ldquo;ubuntu&rdquo; is the user account name on the AWS virtual machine.
The meeting command creates the tunnel using ssh by executing a command like
<pre>
      ssh -N -i vr-key-private.pem -R 52194:localhost:52194 ubuntu@54.215.157.17
</pre>
Connections through the tunnel appear to come from the host machine.
  <li>Tell participants to join the meeting using the AWS virtual machine 
public IP address (for example, command: <b>meet 54.215.157.17</b>).
The participants do not need any authentication or account on the 
AWS virtual machine. If there are participants within the same firewall 
as the meeting host, they can probably connect directly to the host computer 
without using the AWS virtual machine (for example, command:
<b>meet 169.230.21.34</b>). Connections through the tunnel and from 
within the firewall can both be made in the same meeting.
</ol>

<p><b>Future developments</b><br>
Several future developments are intended to simplify ChimeraX meetings 
and handling of firewalls.
</p>

<ol>
<li><b>Remember proxy settings.</b>
Would like an option to remember the meeting command 
<a href="#proxy"><b>proxy</b></a> and 
<a href="#keyForProxy"><b>keyForProxy</b></a> settings
so they don't need to be re-entered for each meeting.

<li><b>Free proxy service</b>.
We will look into providing a free, always-available proxy service 
that requires no setup. We would have to find funds to pay for this,
and it would likely be just a single virtual machine
based in California where ChimeraX is developed.
This may have significant lag for users on other continents.

<li><b>Named meetings.</b>
A cloud virtual machine typically changes IP addresses when stopped and started.
To avoid meeting participants having to know the latest proxy IP address 
to join a meeting, I hope to use a name service where the meeting host 
would give the meeting a name that would be used instead of the host 
computer address. For example, the meeting could be started with command:
<blockquote>
<b>meeting start meetingName sars-antibody</b>
</blockquote>
...and participants could join with:
<blockquote>
<b>meeting sars-antibody</b>
</blockquote>

<li><b>User interface panel</b>.
It would be nice to have a user interface panel as an alternative
to typed commands for starting and joining meetings.
The panel could also show settings such as 
proxy, face image, and participant name.  
</ol>  

<hr>
<address>UCSF Resource for Biocomputing, Visualization, and Informatics / 
October 2020</address>
</body></html>
