<html>

<!--
=== UCSF ChimeraX Copyright ===
Copyright 2016 Regents of the University of California.
All rights reserved.  This software provided pursuant to a
license agreement containing restrictions on its disclosure,
duplication and use.  For details see:
http://www.rbvi.ucsf.edu/chimerax/docs/licensing.html
This notice must be embedded in or attached to all copies,
including partial copies, of the software or any revisions
or derivations thereof.
=== UCSF ChimeraX Copyright ===
-->

<head>
<title>ChimeraX Virtual Reality</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="userdocs.css" />
</head><body>

<a name="top"></a>
<a href="index.html">
<img width="60px" src="ChimeraX-docs-icon.svg" alt="ChimeraX docs icon"
class="clRight" title="User Guide Index"/></a>

<h2>ChimeraX Virtual Reality</h2>

<table align=center border=1 cellpadding=8 cellspacing=0 bgcolor="#f0f0f0">
<tr><td width=600>
<font color="red"><b>Warning</b></font>:
  ChimeraX virtual reality (VR) capabilities have many shortcomings.  A few years of development
  effort will be needed to make these features work well, and only a small fraction of that work
  has been done.
</td></tr>
</table>
<table class="clRight">
<tr><td>
<a href="vive.jpg"><img class="outline" width="250px" src="vive.jpg" 
alt="using HTC Vive VR system" title="click to enlarge..."></a>
</td></tr>
</table>

<p>
ChimeraX allows display and analysis of structures and density maps 
using virtual reality headsets such as HTC Vive,
Vive Pro, Oculus Rift, Samsung Odyssey and Windows Mixed Reality.
For multi-person VR sessions, see the 
<a href="commands/meeting.html"><b>meeting</b></a> command.
ChimeraX can also <a href="vrphone.html">record 360&deg; movies</a>.
</p>

<ul class="none">
<li><a href="#starting"><b>Starting VR Mode</b></a>
<li><a href="#mousemodes"><b>Hand Controller Modes</b></a>
<li><a href="#handproblems"><b>Hand Controller Problems</b></a>
<li><a href="#interactive"><b>Limitations of Interactive Viewing</b></a>
</ul>

<p>
See also the following:
</p>
<blockquote>
<a href="https://www.sciencedirect.com/science/article/pii/S002228361830696X"
target="_blank">Molecular visualization on the holodeck.</a><br>
Goddard TD, Brilliant AA, Skillman TL, Vergenz S, Tyrwhitt-Drake J, Meng EC, Ferrin TE.<br>
<i>J Mol Biol.</i> 2018 Oct 19;430(21):3982-3996.
</blockquote>
<ul>
<li>VR setup advice and observations on different systems:
<a href="http://www.cgl.ucsf.edu/chimera/data/laptop-vr-nov2018/laptopvr.html"
target="_blank">Windows</a>,
<a href="http://www.cgl.ucsf.edu/chimera/data/mac-vr-nov2018/mac-vr.html"
target="_blank">Mac</a>,
<a href="http://www.cgl.ucsf.edu/chimera/data/linux-vr-oct2018/linuxvr.html"
target="_blank">Linux</a>
<li><a href="http://vr.ucsf.edu/" target="_blank">VR at UCSF</a>
<li><a href="tutorials/dicom-vr.html">DICOM in VR tutorial</a>
</ul>

<a name="starting"></a>
<p class="nav">
[<a href="#top">back to top: Virtual Reality</a>]
</p>
<h3>Starting VR Mode</h3>

<p>
Any models displayed in ChimeraX can be shown in virtual reality headsets
supported by <a href="http://steamvr.com">SteamVR</a>, such as HTC Vive, 
Oculus Rift and Samsung Odyssey headsets. Descriptions below are for Vive
hand controllers, but different hand controllers have buttons, triggers,
<i>etc.</i> that are generally similar and function similarly.

<ol>
<li>start <a href="http://store.steampowered.com/about/" 
target="_blank">SteamVR</a> 
<li>start ChimeraX and open some data, for example, a PDB model:
<blockquote>
<b><a href="commands/open.html">open</a> 2gbp</b> 
</blockquote>
<li>enter the ChimeraX command: 
<blockquote>
<a href="commands/device.html#vr"><b>vr on</b></a>
</blockquote>
</ol>
<p>
Models in ChimeraX should then appear in the VR headset.
With the hand controllers (positions shown as colored cones in the headset):
<ul>
<li>models can be moved and rotated by
moving or rotating either controller while squeezing its
<a href="https://www.vive.com/us/support/vive/category_howto/about-the-controllers.html"
target="_blank">trigger</a>
<li>models can be scaled up or down (made larger or smaller) by squeezing the
triggers of both controllers and moving them farther apart 
or closer together, respectively
<li>pressing the Vive 
<a href="https://www.vive.com/us/support/vive/category_howto/about-the-controllers.html"
target="_blank">grip button</a> centers and rescales the model
<li>pressing the Vive
<a href="https://www.vive.com/us/support/vive/category_howto/about-the-controllers.html"
target="_blank">menu button</a> shows the ChimeraX desktop user interface 
(by <a href="commands/device.html#vr">default</a>,
the righthand panel of tool windows)
in the headset, allowing &ldquo;clicking&rdquo; normal desktop controls
such as <a href="index.html#toolbars">toolbar icons</a> to adjust the display 
and to assign <a href="#mousemodes">hand-controller modes</a>
</ul>
<p>
The physical room bounds are shown
as a blue mesh when the headset or a hand controller 
comes close to a physical wall (within about a meter).
Models can be scaled to sizes larger than the physical room.
</p><p>
To turn off rendering in the VR headset and re-enable rendering on the 
desktop display, use the ChimeraX command:
</p>
<blockquote>
<a href="commands/device.html#vr"><b>vr off</b></a>
</blockquote>

<a name="mousemodes"></a>
<p class="nav">
[<a href="#top">back to top: Virtual Reality</a>]
</p>
<h3>Hand Controller Modes</h3>
<p>
Most of the ChimeraX <a href="tools/mousemodes.html">mouse modes</a>
can be used with the VR hand controllers.
To assign a mouse mode to a hand controller button:
</p>

<ol>
<li>press the Vive
<a href="https://www.vive.com/us/support/vive/category_howto/about-the-controllers.html"
target="_blank">menu button</a> to show the ChimeraX desktop user interface 
(by <a href="commands/device.html#vr">default</a>,
including the <a href="tools/mousemodes.html"><b>Mouse Modes</b></a> toolbar)
in the headset.
Holding the menu button allows moving the panel in the VR scene.
<li>put the tip of a hand controller cone on a 
<a href="tools/mousemodes.html">mouse mode icon</a> and click with
<a href="https://www.vive.com/us/support/vive/category_howto/about-the-controllers.html"
target="_blank">trigger, trackpad, or grip</a> hand controller buttons to assign
that mouse mode to the clicked button
</ol>
<p>
There are three assignable buttons on each controller,
so six modes can be assigned. However, keeping the default
<a href="https://www.vive.com/us/support/vive/category_howto/about-the-controllers.html"
target="_blank">trigger</a> assignment (rotation or translation, equivalent in VR)
is recommended to allow manipulation as described <a href="#starting">above</a>.
</p><p>
Functions include:
</p>

<ul>
  <li>Selection
  <li>Rotation + translation (single mode) - default/recommended for triggers
  <li>Zooming
  <li>Rotate and translate selected model only
  <li>Move clip planes
  <li>Rotate clip planes
  <li>Label atoms
  <li>Change map contour level
  <li>Crop map box
  <li>Place markers, move, resize, delete, connnect markers
  <li>Play 3D image time series
  <li>Rotate bonds
  <li>Tug on atoms with molecular dynamics
  <li>Run molecular dynamics on residue and neighbors
  <li>Swap an amino acid
  <li>Limit atomic and map display to a zone around a residue
</ul>

<p>
  Modes that require clicking on an atom such as selection or labeling require pointing at the atom
  with the hand controller cone.  This is easiest to do at close range, although it can work at a distance
  but requires accurate pointing.  Modes that involve dragging on the desktop such as changing the contour
  level of a map or zooming are operated by clicking and moving the hand controller vertically.  The bond
  rotation mouse mode operates by dragging on the desktop, but in VR operates by rotating the hand controller.
  Translation and rotation are separate mouse modes but are a single hand controller mode.
</p>

<a name="handproblems"></a>
<p class="nav">
[<a href="#top">back to top: Virtual Reality</a>]
</p>
<h3>Hand Controller Problems</h3>

<p>
  Several factors make it difficult to use the hand controllers.  These problems can be remedied but we
  have not yet had time to fix them.
</p>

<p><b>No click feedback.</b> 
There is no visual indication when you click a mouse mode icon. 
The icons are small and easy to miss. It helps to move the panel close 
by holding the menu button on the hand controller. 
The <a href="tools/log.html"><b>Log</b></a> will show if the mode was changed.
</p>
<p><b>No mode indicator.</b> 
There is no visual indication of what modes are currently assigned to the buttons.
It is easy to forget the six modes assigned to the two controllers.
In the future we plan to put the mode icon on the cone at the location of 
each of the three assignable buttons.
</p>
<p><b>Blackout.</b> 
Modes that perform calculations taking longer than 1/90th second cause the 
graphics not to update, and the VR scene will gray out after a fraction 
of a second without graphics updates. Changing map contour level and 
running molecular dynamics are prone to this problem.
In the future these calculations will be done in parallel 
so the graphics will not be slowed down.
</p>
<p><b>Flickering labels.</b>
Atom labels or residue labels crated by the swap amino acid mode can cause
scene flicker because the labels are slow to render.
Graphics optimization is needed.
</p>
<p><b>Selection outlines.</b>
Green selection outlines can slow rendering and cause flicker.
</p>

<a name="interactive"></a>
<p class="nav">
[<a href="#top">back to top: Virtual Reality</a>]
</p>
<h3>Limitations of Interactive Viewing</h3>
<p>
<font color="red" size="+1"><b>Motion sickness warning</b></font>:
If the model is stuttering or flickering in the headset
(due to insufficient rendering speed), then you should stop viewing it,
as this can easily and suddenly induce nausea that could last as long as
24 hours. Even without the stuttering, 
if you feel any motion sickness, stop using the headset.
Progression from slight nausea to needing to throw up can happen quickly.
</p>

<p>
<b>Operating systems</b>. 
We have tested ChimeraX VR on Windows 10 with an Nvidia Geforce GTX 1080 
graphics card and with an AMD Radeon RX 480 graphics card.
As of November 2018, SteamVR works well on Windows on Windows 10,
has <a href="http://www.cgl.ucsf.edu/chimera/data/mac-vr-nov2018/mac-vr.html">some support on macOS</a> High Sierra and Mojave,
and can <a href="http://www.cgl.ucsf.edu/chimera/data/linux-vr-oct2018/linuxvr.html">work on Linux</a>.
</p>

<p>
<b>Small models only</b>.
Large molecular structures (more than a few thousand atoms) render too slowly
and will cause stuttering in the headset.
Large density map surfaces also cause stuttering;
a 200<sup>3</sup> map at full resolution should work, but larger sizes 
may require <a href="tools/volumeviewer.html#step">subsampling</a> (step 2).
Current headsets render at 90 frames per second in two eyes,
so the effective rendering speed needed to avoid flickering is about 
200 frames per second. By comparison, a rendering speed of 10 frames
per second is adequate on a conventional desktop display.
</p>
<p>
<b>Simple lighting</b>.
By default ChimeraX switches to simple lighting when VR is enabled -- other
<a href="commands/lighting.html">lighting modes</a> render too slowly and cause stuttering.
</p><p>
<b>Desktop rendering</b>.
The ChimeraX graphics on your normal computer display will show what the user
sees in the VR headset. Rendering to the conventional display
(generally 60 frames per second) can slow the VR rendering if ChimeraX is not
able to switch to a mode where graphics is not synchronized to vertical refresh.
To test if this is the cause of stuttering you can use the 
<a href="commands/device.html#vr"><b>vr</b></a> command option
<b>display blank</b> to prevent graphics from updating on the desktop display.
An alternative mirroring can be done by the SteamVR runtime using
SteamVR menu entry &ldquo;Mirror Display.&rdquo;
</p><p>
<b>Side View should be closed</b>.
The ChimeraX <a href="tools/sideview.html"><b>Side View</b></a> tool 
will slow headset rendering and cause stuttering, so it
should be closed during VR viewing.
</p>

<p>
<b>Difficult to change model display</b>.
Changing molecule or map display can be done by displaying the desktop
in the headset  using the Vive controller
<a href="https://www.vive.com/us/support/vive/category_howto/about-the-controllers.html"
target="_blank">menu button</a>.
Then use the hand controllers to &ldquo;click&rdquo;  icons in the ChimeraX
<a href="tools/moldisplay.html"><b>Molecule Display</b></a>
and <a href="tools/densitymaps.html"><b>Density Maps</b></a> toolbars
to change the display.
Alternatively the display can be changed by removing the headset and using
the ChimeraX  interface on the conventional display with mouse and keyboard.
</p>

<p>
<b>Clipping when models far away</b>.
If models are scaled to a very large size, parts more than 
500 meters away (in physical room dimensions) will be clipped.  
This may seem like a large distance, but as a model is scaled up
it may appear to stop increasing in size because
stereoscopic depth perception is not effective beyond about 10 meters.
As parts of the model get both larger and farther away at the same rate, 
the change in size is not evident.
To gauge model size, it can be useful to move a hand controller near 
a physical wall so that the blue mesh will provide a reference distance.
</p>

<p>
<b>Dynamic scenes may render too slowly.</b>
Dynamic (time-varying) scenes are more interesting to view than static scenes.
We have successfully displayed 3D optical microscopy time series of crawling 
cells using the command
<a href="commands/vseries.html#play"><b>vseries play</b></a>
with the <a href="commands/vseries.html#cacheFrames"><b>cacheFrames</b></a>
option so that all surface depictions are precomputed;
without that option, the VR headset rendering is too slow.
It may also help to change the scene at a slower pace, 
for example using 
<a href="commands/vseries.html#play"><b>vseries play</b></a> with the 
<a href="commands/vseries.html#maxFrameRate"><b>maxFrameRate</b></a> option.
A molecular dynamics trajectories can be played with the
<a href="commands/coordset.html"><b>coordset</b></a> command.  Use the
coordset <b>pauseFrames 9</b> option to slow the playback rate from the
90 frames per second of the headset to 10 frames per second.
</p>

<p>
  <b>SteamVR room boundaries wrong.</b>
  Sometimes tracing room boundaries using room-scale room setup in SteamVR produces
  incorrect results (November 2018).
  We have observed this when the traced space is not a simple rectangle because of a desk
  against one wall.  Tracing around the desk joins the 6 corners of the bounds in
  the wrong order -- a different order than they were traced.  It is unclear what is wrong
  with the SteamVR room setup algorithm.  But we have found that clicking the room tracing
  "Advanced Mode" checkbutton which allows you to click at each corner of the room reliably
  produces the correct SteamVR bounds.
</p>

<hr>
<address>UCSF Resource for Biocomputing, Visualization, and Informatics /
February 2019</address>
</body></html> 
