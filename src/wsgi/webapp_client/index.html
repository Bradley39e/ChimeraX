<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
        "https://www.w3.org/TR/html4/strict.dtd">
<html>
<!-- vi: se sw=2: -->
<head>
<meta charset="utf-8"/>
<title>Chimera 2 Web Application</title>
<!-- standard jquery/jquery-ui -->
<script type="text/javascript" src="https://code.jquery.com/jquery-1.9.1.js"></script>
<link rel="stylesheet" type="text/css" href="https://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css"/>
<script type="text/javascript" src="https://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" />
<script src="https://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>

<!-- additional widgets -->
<script type="text/javascript" src="js/jquery.jec-1.3.4.js"></script>

<!-- chimera2 libraries -->
<script type="text/javascript" src="js/c2/session.js"></script>

<!-- WebGL support -->
<!-- <script type="text/javascript" src="webgl/webgl-debug.js"></script> -->
<script type="text/javascript" src="webgl/webgl-utils.js"></script>
<script type="text/javascript" src="webgl/webgl-context.js"></script>
<script type="text/javascript" src="webgl/llgr_webgl.js"></script>
<script type="text/javascript" src="js/gl-matrix.js"></script>
<script type="text/javascript" src="js/vsphere.js"></script>

<!-- page-specific script and css -->
<style type="text/css">
html, body { height:100%; }
th, td { padding:0; }
#app .ui-header { height:50px; }
#app .ui-footer { height:50px; }
.header-left { text-align:left; padding:0px 10px; }
.header-right { text-align:right; padding:0px 10px; }
.footer-button { width:100px; }
.footer-left { text-align:left; padding:0px 10px; line-height:50px; }
.footer-center { text-align:center; padding:0px 10px; line-height:50px; }
.footer-right { text-align:right; padding:0px 10px; line-height:25px; }
.main-content { position:absolute; top:52px; right:0; left:0;
			padding:0; margin:0; }
.bottom-zone { position:absolute; bottom:0; left:0px; right:0px; }
.vertical-zones { padding:0; margin:0; width:100%; table-layout:fixed;
			height:100%; }
.vertical-zone { height:100%; display:inline-block; margin:0; padding:0; overflow:auto; }
#molview {
  position: relative;
  margin: 0px;
  padding: 0px;
  width: 100%;
  height: 100%;
}
</style>

<script type="text/javascript">

function array_search(arr, func) {
	if (!func || typeof(func) != 'function')
		return -1;
	if (!arr || !arr.length || arr.length < 1)
		return -1;
	var len = arr.length;
	for (var i = 0; i < len; ++i) {
		if (func(arr[i]))
			return i;
	}
	return -1;
}

function array_reverse_search(arr, func) {
	if (!func || typeof(func) != 'function')
		return -1;
	if (!arr || !arr.length || arr.length < 1)
		return -1;
	for (var i = arr.length - 1; i >= 0; --i) {
		if (func(arr[i]))
			return i;
	}
	return -1;
}

function array_index_of(arr, field, value) {
	var i = array_search(arr, function(obj) {
		if (obj[field] != undefined)
			return obj[field] == value;
		else
			return false;
	});
	return i;
} 

function array_last_index_of(arr, field, value) {
	var i = array_reverse_search(arr, function(obj) {
		if (obj[field] != undefined)
			return obj[field] == value;
		else
			return false;
	});
	return i;
} 

// show_error is global
function show_error(message) {
	show_status(message, { error: true, delay: 10000 });
	return;
	// TODO: dialog not working with jQuery mobile, use popup
	var dialog_id = "error_dialog_" + new Date().getTime();
	$("body").append("<div id=\"" + dialog_id + "\"><p>"
		+ "<span class=\"ui-icon ui-icon-alert\" style=\"float: left; margin: 0 7px 20px 0;\"></span>"
		+ "<div>" + message + "</div></p></div>");
	$("#" + dialog_id).dialog({
		dialogClass: "error",
		title: "Chimera2 Error",
		resizable: false,
		height: 160,
		modal: true,
		buttons: {
			"Close": function () {
				$(this).dialog("close");
			}
		},
		beforeClose: function (event, ui) {
			// remove dialog div from document
			$("#" + dialog_id).remove();
		}
	});
}

// show_status is global
function show_status(message, options) {
	options = options || {};
	var delay = options.delay || 3000;	// milliseconds
	var error = options.error || false;
	var temporary = options.temporary || false;
	var sl = $("#status_line");
	sl.clearQueue().html(message);
	if (error)
		sl.addClass("ui-state-error-text");
	sl.delay(delay).queue(function () {
		$(this).html("&nbsp;").removeClass("ui-state-error-text").dequeue();
	});
	if (!temporary) {
		if (!error)
			$c2_session.log(message);
		else {
			$c2_session.log("<div class=\"ui-state-error-text\">" + message + "</div>");
		}
	}
}

/**
 * Generates a camera orientation matrix with the given eye position,
 * focal point, and up axis.  It similar to the look-at matrix, but the
 * center is placed at the origin instead of the eye.
 *
 * @param {mat4} out mat4 frustum matrix will be written into
 * @param {vec3} eye Position of the viewer
 * @param {vec3} center Point the viewer is looking at
 * @param {vec3} up vec3 pointing up
 * @returns {mat4} out
 */
mat4.camera_orientation = function (out, eye, center, up) {
    var x0, x1, x2, y0, y1, y2, z0, z1, z2, len,
        eyex = eye[0],
        eyey = eye[1],
        eyez = eye[2],
        upx = up[0],
        upy = up[1],
        upz = up[2],
        centerx = center[0],
        centery = center[1],
        centerz = center[2];

    var GLMAT_EPSILON = 0.000001;
    if (Math.abs(eyex - centerx) < GLMAT_EPSILON &&
        Math.abs(eyey - centery) < GLMAT_EPSILON &&
        Math.abs(eyez - centerz) < GLMAT_EPSILON) {
        return mat4.identity(out);
    }

    z0 = eyex - centerx;
    z1 = eyey - centery;
    z2 = eyez - centerz;

    len = 1 / Math.sqrt(z0 * z0 + z1 * z1 + z2 * z2);
    z0 *= len;
    z1 *= len;
    z2 *= len;

    x0 = upy * z2 - upz * z1;
    x1 = upz * z0 - upx * z2;
    x2 = upx * z1 - upy * z0;
    len = Math.sqrt(x0 * x0 + x1 * x1 + x2 * x2);
    if (!len) {
        x0 = 0;
        x1 = 0;
        x2 = 0;
    } else {
        len = 1 / len;
        x0 *= len;
        x1 *= len;
        x2 *= len;
    }

    y0 = z1 * x2 - z2 * x1;
    y1 = z2 * x0 - z0 * x2;
    y2 = z0 * x1 - z1 * x0;

    len = Math.sqrt(y0 * y0 + y1 * y1 + y2 * y2);
    if (!len) {
        y0 = 0;
        y1 = 0;
        y2 = 0;
    } else {
        len = 1 / len;
        y0 *= len;
        y1 *= len;
        y2 *= len;
    }

    out[0] = x0;
    out[1] = y0;
    out[2] = z0;
    out[3] = 0;
    out[4] = x1;
    out[5] = y1;
    out[6] = z1;
    out[7] = 0;
    out[8] = x2;
    out[9] = y2;
    out[10] = z2;
    out[11] = 0;
    out[12] = -(x0 * centerx + x1 * centery + x2 * centerz);
    out[13] = -(y0 * centerx + y1 * centery + y2 * centerz);
    out[14] = -(z0 * centerx + z1 * centery + z2 * centerz);
    out[15] = 1;

    return out;
};

(function () {
"use strict";

function BBox(llb, urf) {
    // right-handed axis-aligned bounding box
    // 
    // if either llb or urf are undefined,
    // then the bounding box is uninitialized.
    this.llb = llb;	// lower-left-back corner coordinates
    this.urf = urf;	// upper-right-front corner coordinates
}

BBox.prototype.add = function (pt) {
    // expand bounding box to encompass given point
    if (this.llb === undefined) {
	this.llb = vec3.copy(vec.create(), pt);
	this.urf = vec3.copy(vec.create(), pt);
	return;
    }
    for (var i = 0; i < 3; ++i) {
	if (pt[i] < this.llb[i])
	    this.llb[i] = pt[i];
	else if (pt[i] > this.urf[i])
	    this.urf[i] = pt[i];
    }
}

BBox.prototype.add_bbox = function (box) {
    // expand bounding box to encompass given bounding box
    if (this.llb === undefined) {
	this.llb = box.llb;
	this.urf = box.urf;
	return;
    }
    for (var i = 0; i < 3; ++i) {
	if (box.llb[i] < this.llb[i])
	    this.llb[i] = box.llb[i];
	if (box.urf[i] > this.urf[i])
	    this.urf[i] = box.urf[i];
    }
}

BBox.prototype.bulk_add = function (pts) {
    throw "bulk_add not implemented";
    // expand bounding box to encompass all given points
    mi = amin(pts, axis=0)	// TODO
    ma = amax(pts, axis=0)	// TODO
    if (this.llb === undefined) {
	this.llb = vec3.copy(vec3.create(), mi);
	this.urf = vec3.copy(vec3.create(), ma);
	return;
    }
    for (var i = 0; i < 3; ++i) {
	if (mi[i] < this.llb[i])
	    this.llb[i] = mi[i];
	if (ma[i] > this.urf[i])
	    this.urf[i] = ma[i];
    }
}

BBox.prototype.center = function () {
    // return center of bounding box
    if (this.llb === undefined)
	throw "empty bounding box";
    var c = vec3.add(vec3.create(), this.llb, this.urf);
    vec3.scale(c, c, .5);
    return c;
}

BBox.prototype.size = function () {
    // return length of sides of bounding box
    if (this.llb === undefined)
	throw "empty bounding box";
    return vec3.subtract(vec3.create(), this.urf, this.llb);
}

BBox.prototype.xform = function (xf) {
    // transform bounding box in place
//  if xf.isIdentity:
//	return;
    b = BBox([0., 0., 0.], [0., 0., 0.]);
    for (var i = 0; i < 3; ++i) {
	b.llb[i] = b.urf[i] = xf._matrix[i][3];
	for (var j = 0; j < 3; ++j) {
	    coeff = xf._matrix[i][j];
	    if (coeff == 0)
		continue;
	    if (coeff > 0) {
		b.llb[i] += this.llb[j] * coeff;
		b.urf[i] += this.urf[j] * coeff;
	    } else {
		b.llb[i] += this.urf[j] * coeff;
		b.urf[i] += this.llb[j] * coeff;
	    }
	}
    }
    this.llb = b.llb;
    this.urf = b.urf;
}

function Camera() {
	this.eye = vec3.fromValues(0, 0, 0);
	this.at = vec3.fromValues(0, 0, -1);
	this.up = vec3.fromValues(0, 1, 0);
	this.ortho = false;
}

Camera.prototype.reset = function (width, height, fov, bbox) {
	// The camera is a simple one that takes the :param fov: and
	// the current bounding box, and calculates the eye position
	// and looks at the bounding box down the negative z-axis.
	this.at = bbox.center();
	var half_size = bbox.size();
	vec3.scale(half_size, half_size, .5 * 1.1);	// + 10%
	this.width2 = half_size[0];
	this.height2 = half_size[1];
	var depth2 = half_size[2];
	this.update_viewport(width, height);

	this.near = this.height2 / Math.tan(fov / 2);
	this.far = this.near + 2 * depth2;
	this.eye = vec3.fromValues(this.at[0], this.at[1], this.at[2] + this.near + depth2);
	this.up = vec3.fromValues(0, 1, 0);	// Direction
}

Camera.prototype.update_viewport = function (width, height) {
	var win_aspect = width / height;
	var scene_aspect = this.width2 / this.height2;
	if (win_aspect > scene_aspect)
		this.width2 = this.height2 * win_aspect;
	else
		this.height2 = this.width2 / win_aspect;
}

Camera.prototype.matrices = function () {
	var projection;
	if (this.ortho) {
		projection = mat4.ortho(mat4.create(),
			-this.width2, this.width2,
			-this.height2, this.height2,
			this.near, this.far);
	} else {
		projection = mat4.frustum(mat4.create(),
			-this.width2, this.width2,
			-this.height2, this.height2,
			this.near, this.far);
	}
	var modelview = mat4.lookAt(mat4.create(), this.eye, this.at, this.up);
	return [projection, modelview];
}

Camera.prototype.rotate = function (axis, angle) {
	var xf = Rotation(axis, angle);
	this.xform(xf);
}

Camera.prototype.xform = function (xf) {
	//if not xf._pure:
	//	throw 'only pure rotation is allowed);
	var modelview = mat4.camera_orientation(mat4.create(), this.eye, this.at, this.up);
	var inv_modelview = mat4.invert(mat4.create(), modelview);
	var inv_xf = mat4.invert(mat4.create(), xf);
	var nxf = mat4.create();
	mat4.multiply(nxf, nxf, inv_modelview);
	mat4.multiply(nxf, nxf, inv_xf);
	mat4.multiply(nxf, nxf, modelview);

	vec3.transformMat4(this.eye, this.eye, nxf);
	var rot = mat3.fromMat4(mat3.create(), nxf);
	vec3.transformMat3(this.up, this.up, rot);
	vec3.transformMat4(this.at, this.at, nxf);
}

$(document).ready(function() {
	$c2_session.ui_init("..");
	$("#command_line").keyup(
		function (evt) {
			if (evt.which != 13)
				return;
			$c2_session.send_command($(this).val());
		});
	$c2_session.register_data_function("llgr", process_llgr_data);
	$c2_session.register_data_function("scene", process_scene_data);
	$c2_session.register_data_function("info", show_status);
	molview_init();
})

function process_llgr_data(json) {
	// json is list of llgr commands
	var index = array_last_index_of(json, 0, "clear_all");
	if (index == -1) {
		// partial update, so merge with existing data
		llgr.load_json(json);
		molview_ci.data = molview_ci.data.concat(json);
		molview_ci.redraw();
	} else {
		json.splice(0, index + 1);
		molview_ci.data = json;
		molview_ci.init();
	}
}

var camera = null;
var scene_bbox;
var scene_fov;

function process_scene_data(data) {
	var bbox = data["bbox"];
	if (bbox === undefined) {
		return;
	}
	bbox = new BBox(vec3.fromValues.apply(null, bbox[0]),
	    				vec3.fromValues.apply(null, bbox[1]));
	if (bbox != scene_bbox) {
		scene_bbox = bbox;
		// TODO: update camera
		camera = null;
	}
	var fov = data["fov"];
	if (fov === undefined)
		return;
	if (fov != scene_fov) {
		scene_fov = fov;
		// TODO: update camera
	}
	var eye = vec3.fromValues.apply(null, data["eye"]);
	var at = vec3.fromValues.apply(null, data["at"]);
	var up = vec3.fromValues.apply(null, data["up"]);
	// TODO: setup camera
}

var molview_ci;		// molview context information

var button_pressed = false;
var mouse_position;

function molview_zoom(event) {
	console.log("zoom:", event);
	event.stopPropagation();
}

function get_rel_xy(event) {
	var widget = event.currentTarget;
	var widget_offset = $(widget).offset();
	return {
		x: event.pageX - widget_offset.left,
		y: event.pageY - widget_offset.top
	};
}

function molview_mouse_down(event) {
	// TODO: change cursor
	console.log("mouse_down:", event);
	event.stopPropagation();
	button_pressed = true;
	var canvas = event.currentTarget;
	var radius = 0.9 * 0.5 * Math.min(canvas.width, canvas.height);
	mouse_position = get_rel_xy(event);
	mouse_position.x = (mouse_position.x - (canvas.width / 2)) / radius;
	mouse_position.y = ((canvas.height / 2) - mouse_position.y) / radius;
}

function molview_mouse_move(event) {
	// TODO: change cursor
	if (!button_pressed || camera === null)
		return;
	event.stopPropagation();
	var canvas = event.currentTarget;
	var radius = 0.9 * 0.5 * Math.min(canvas.width, canvas.height);
	var new_position = get_rel_xy(event);
	new_position.x = (new_position.x - (canvas.width / 2)) / radius;
	new_position.y = ((canvas.height / 2) - new_position.y) / radius;
	var rot_mat;
	try {
		rot_mat = vsphere(mouse_position, new_position);
	} catch (err) {
		// skip
	}
	mouse_position = new_position;
	if (rot_mat === undefined)
		return;
	camera.xform(rot_mat);
	molview_ci.redraw();
}

function molview_mouse_up(event) {
	// TODO: change cursor
	//console.log("mouse_up:", event);
	event.stopPropagation();
	button_pressed = false;
}

function molview_update_size() {
	var footer = $("[data-role=footer]");
	var bottom_zone = $("#bottom-zone");
	var content = $("#content-all");
	/*
	console.log("bottom_zone height: " + bottom_zone.height());
	*/

	var footer_height = footer.outerHeight(true);
	/*
	console.log("content bottom 1: " + bottom_zone.css("bottom")
			+ " " + content.css("bottom"));
	*/
	bottom_zone.css("bottom", footer_height);
	var bottom_height = bottom_zone.outerHeight(true) + footer_height;
	/*
	console.log("content bottom 2: " + bottom_zone.css("bottom")
			+ " " + content.css("bottom"));
	*/
	content.css("bottom", bottom_height);
	/*
	console.log("content bottom 3: " + bottom_zone.css("bottom")
			+ " " + content.css("bottom"));
	console.log("footer height: " + footer_height
			+ " bottom height: " + bottom_height);
	*/

	// Make canvas use display resolution (no scaling)
	var canvas = document.getElementById("molview");
	resizeCanvasToDisplaySize(canvas);
	if (molview_ci !== undefined)
		molview_ci.redraw();
}

function molview_init() {
	var canvas = document.getElementById("molview");
	var gl = getWebGLContext(canvas, {
		alpha: false,
		antialias: true
	});
	if (!gl)
		return;

	molview_update_size();
	molview_ci = new ContextInfo(canvas, gl, draw_scene);
	molview_ci.init();
	molview_ci.redraw();
	$("#molview")
		.on('wheel', molview_zoom)
		.mousedown(molview_mouse_down)
		.mousemove(molview_mouse_move)
		.mouseup(molview_mouse_up);
}

function draw_scene(ci) {
	//console.log("draw_scene");
	var canvas = ci.canvas;
	var gl = ci.gl;
	var width = canvas.width;
	var height = canvas.height;
	$c2_session.set_state("width", width);
	$c2_session.set_state("height", height);
	llgr.set_context(gl);
	gl.viewport(0, 0, width, height);
	if (camera !== null) {
		camera.update_viewport(width, height);
	} else {
		if (scene_bbox === undefined) {
			gl.clear(gl.COLOR_BUFFER_BIT);
			return;
		}
		camera = new Camera();
		camera.reset(width, height, scene_fov, scene_bbox);
	}
	var result = camera.matrices();
	var projection = result[0];
	var modelview = result[1];
	llgr.set_uniform_matrix(0, 'ProjectionMatrix', false,
		llgr.Mat4x4, projection);
	llgr.set_uniform_matrix(0, 'ModelViewMatrix', false,
		llgr.Mat4x4, modelview);
	llgr.set_uniform_matrix(0, 'NormalMatrix', false,
		llgr.Mat3x3, mat3.fromMat4(mat3.create(), modelview));
	llgr.render();
}

$(document).bind("pageshow", "#app", function() {
/* resizing not available on mobile devices
	$("#molview").resizable({
		handles: "",
		resize: function (event, ui) {
			$("canvas", this).each(function () {
				$(this).attr({
					width: ui.size.width,
					height: ui.size.height
				});
				molview_ci.redraw();
			});
		},
	});
*/
	$(window).on("resize", function(event) {
			molview_update_size();
		      	});
	$("[data-role=header]").fixedtoolbar({ tapToggle: false });
	$("[data-role=footer]").fixedtoolbar({ tapToggle: false });
	molview_update_size();
});

}());

</script>
</head>
<body>
<div id="app" data-role="page" class="ui-responsive-panel" style="overflow:hidden; padding:0;">

<!--panels-->
<div data-role="panel" data-position-fixed="true"
	data-display="push" id="log_panel">
  <h2>Message Log</h2>
  <p id="log" style="font-size: smaller; height:80vh; overflow:auto;"></p>
  <a data-role="button" data-rel="close" data-icon="delete" href="#">Close</a>
</div>
<div data-role="panel" data-position-fixed="true"
	data-display="push" data-position="right" id="debug_panel">
  <h2>Debug Log</h2>
  <p id="debug" style="font-size: smaller; height:80vh; overflow:auto;">Debug text</p>
  <a data-role="button" data-rel="close" data-icon="delete" href="#">Close</a>
</div>
<!--end panels-->

<!--popups-->
<div data-role="popup" class="ui-content"
	name="popup_session_open" id="popup_session_open">
  <a href="#" data-rel="back" data-role="button"
  	data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a>
  <h3>My Sessions</h3>
  <form>
    <label for="my_sessions">Session:</label>
    <select name="my_sessions" id="my_sessions" data-mini="true">
      <option value="xyzzy">xyzzy</option>
      <option value="plugh">plugh</option>
    </select>
    <label for="my_password">Password:</label>
    <input type="password" name="my_password" id="my_password"
	  value="" data-mini="true" />
    <input type="button" value="Open" id="open_session"
	  data-inline="true" data-mini="true" data-theme="b"/>
    <input type="button" value="Delete" id="delete_session"
	  data-inline="true" data-mini="true" data-theme="b"/>
  </form>
</div>
<div data-role="popup" class="ui-content"
	name="popup_session_new" id="popup_session_new">
  <a href="#" data-rel="back" data-role="button"
  	data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a>
  <h3>New Sessions</h3>
  <form>
    <label for="new_session">Session:</label>
    <input type="text" name="new_session" id="new_session"
	  value="" data-mini="true" />
    <label for="new_password">Password:</label>
    <input type="password" name="new_password" id="new_password"
	  value="" data-mini="true" />
    <input type="button" value="Create" id="open_new_session"
	  data-inline="true" data-mini="true" data-theme="b"/>
  </form>
</div>
<div data-role="popup" class="ui-content"
	name="popup_session_shared" id="popup_session_shared">
  <a href="#" data-rel="back" data-role="button"
  	data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a>
  <h3>Shared Session</h3>
  <form>
    <label for="shared_username">User name:</label>
    <input type="text" name="shared_username" id="shared_username"
	  value="" data-mini="true" />
    <label for="shared_session">Session:</label>
    <input type="text" name="shared_session" id="shared_session"
	  value="" data-mini="true" />
    <label for="shared_password">Password:</label>
    <input type="password" name="shared_password" id="shared_password"
	  value="" data-mini="true"/>
    <input type="button" value="Open" id="open_shared_session"
	  data-inline="true" data-mini="true" data-theme="b"/>
  </form>
</div>
<!--end popups-->

<!--header-->
<div data-role="header" data-position="fixed">
  <div class="ui-grid-a">
    <div class="ui-block-a header-left">
      <div data-role="controlgroup" data-type="horizontal" data-mini="true">
	<a href="#menuSession" data-rel="popup" data-role="button"
		data-inline="true" data-transition="slidedown">
		Sessions...</a>
	  <div data-role="popup" id="menuSession">
	    <ul data-role="listview" data-inset="true">
	      <li><a data-rel="popup" href="#popup_session_open">
	      	Open Session</a></li>
	      <li><a data-rel="popup" href="#popup_session_new">
	      	New Session</a></li>
	      <li><a data-rel="popup" href="#popup_session_shared">
	      	Shared Session</a></li>
	    </ul>
	  </div>
	<a href="#menuZone" data-rel="popup" data-role="button"
		data-inline="true" data-transition="slidedown">
		Zones...</a>
	  <div data-role="popup" id="menuZone">
	    <fieldset data-role="controlgroup" style="margin:0;">
	      <input name="zone-left" id="zone-left" type="checkbox">
	      <label for="zone-left">Left</label>
	      <input name="zone-right" id="zone-right" type="checkbox">
	      <label for="zone-right">Right</label>
	      <input name="zone-bottom" id="zone-bottom" type="checkbox">
	      <label for="zone-bottom">Bottom</label>
	      </select>
	    </fieldset>
	  </div>
      </div>
    </div>
    <div class="ui-block-b header-right">
      <a data-role="button" data-inline="true">Help</a>
    </div>
  </div>
</div>
<!--end header-->

<!--main content-->
<!-- three columns for left-zone, graphics, right-zone -->
<!--
<div class="main-content" id="content-all">
  <table id="content-graphics" class="vertical-zones">
    <tr>
      <td id="zone-div-left" class="vertical-zone" style="width:20%;">
	Hello, left
      </td>
      <td id="zone-div-center" class="vertical-zone" style="width:60%;">
       <canvas id="molview" class="ui-widget-content"
	      style="border:0; height:100%;">
	Your browser does not support the HTML5
	<code>&lt;canvas&gt;</code> element.
	<a href="http://get.webgl.org">Click here to upgrade your browser.</a>
       </canvas>
      </td>
      <td id="zone-div-right" class="vertical-zone" style="width:20%;">
	Hello, right
      </td>
    </tr>
  </table>
</div>
-->
<div class="main-content" id="content-all">
  <div id="zone-div-left" class="vertical-zone" style="width:19%;">
    Hello, left
  </div>
  <div id="zone-div-center" class="vertical-zone" style="width:60%;">
   <canvas id="molview" class="ui-widget-content"
	  style="margin:0; border:0; height:99%;">
   </canvas>
  </div>
  <div id="zone-div-right" class="vertical-zone" style="width:19%;">
    Hello, right
  </div>
</div>
<!-- bottom zone -->
<div class="bottom-zone" id="bottom-zone">
  <div id="bottom-widgets" style="position:relative;">
    <label for="command_line">Command:</label>
    <input id="command_line" type="text" size="100"/>
  </div>
  <div id="status_line">Status line</div>
</div>
<!--end main content-->

<!--footer-->
<div data-role="footer" data-position="fixed">
  <div class="ui-grid-b">
    <div class="ui-block-a footer-left">
      <div data-role="controlgroup" data-type="horizontal" data-mini="true">
	<a data-role="button" data-mini="true"
	      class="footer-button" href="#log_panel">Log</a>
	<a data-role="button" data-mini="true"
	      class="footer-button" href="#debug_panel">Debug Log</a>
      </div>
    </div>
    <div class="ui-block-b footer-center">
      <span id="active_session">No session selected</span>
    </div>
    <div class="ui-block-c footer-right">
      Chimera 2 Mobile<br/>
      Developed at the <a href="http://www.rbvi.ucsf.edu">RBVI</a>
    </div>
  </div>
</div>
<!--end footer-->

</div>
</body>
</html>
