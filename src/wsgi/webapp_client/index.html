<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
        "https://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta charset="utf-8"/>
<title>Session Javascript Test Page</title>
<!-- standard jquery/jquery-ui -->
<script type="text/javascript" src="https://code.jquery.com/jquery-1.9.1.js"></script>
<link rel="stylesheet" type="text/css" href="https://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css"/>
<script type="text/javascript" src="https://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>

<!-- additional widgets -->
<script type="text/javascript" src="js/jquery.jec-1.3.4.js"></script>

<!-- chimera2 libraries -->
<script type="text/javascript" src="js/c2/session.js"></script>

<!-- WebGL support -->
<script type="text/javascript" src="webgl/webgl-debug.js"></script>
<script type="text/javascript" src="webgl/webgl-utils.js"></script>
<script type="text/javascript" src="webgl/webgl-context.js"></script>
<script type="text/javascript" src="webgl/llgr_webgl.js"></script>

<!-- page-specific script and css -->
<style type="text/css">
#molview {
	position: relative;
	margin: 0px;
}
</style>

<script type="text/javascript">
$(document).ready(function() {
	$("#tabs").tabs();
	$c2_session.ui_init("..");
	$("#command_line").keyup(
		function (evt) {
			if (evt.which != 13)
				return;
			$c2_session.send_command($(this).val());
		});
	$c2_session.register_data_function("llgr", process_llgr_data);
	$c2_session.register_data_function("scene", process_scene_data);
	molview();
})

function process_llgr_data(data) {
	var json = JSON.parse(data);
	load(json);
}

function process_scene_data(data) {
	// TODO
}

var molview_ci;		// molview context information

function molview() {
	var canvas = document.getElementById("molview");
	var gl = getWebGLContext(canvas, {
		alpha: false,
		antialias: true
	});
	if (!gl)
		return;

	molview_ci = new ContextInfo(canvas, gl, drawScene);
	molview_ci.init();
	molview_ci.redraw();
}

function drawScene(ci) {
	var canvas = ci.canvas;
	var gl = ci.gl;
	$c2_session.set_state("width", canvas.width);
	$c2_session.set_state("height", canvas.height);
	llgr.set_context(gl);
	gl.viewport(0, 0, canvas.width, canvas.height);
	llgr.render();
	ci.requestId = null;
}

function load(json_or_url) {
	molview_ci.data = json_or_url;
	molview_ci.init();
	molview_ci.redraw();
}

$(function() {
	$("#molview").resizable({
		handles: "",
		resize: function (event, ui) {
			$("canvas", this).each(function () {
				$(this).attr({
					width: ui.size.width,
					height: ui.size.height
				});
				molview_ci.redraw();
			});
		},
	});
});

</script>
</head>
<body>
<h1>Session Javascript Test Page</h1>
<div id="tabs">
  <ul>
    <li><a href="#tabs_main">Main Graphics</a></li>
    <li><a href="#tabs_log">Log</a></li>
    <li><a href="#tabs_debug">Debug Log</a></li>
  </ul>
  <div id="tabs_main">
    <hr/>
    <div>
      <strong>Command:</strong>
      <input id="command_line" type="text" size="100"/>
      <span id="c2_session"/>
    </div>
    <div>
      <span id="status_line">&nbsp;</span>
    </div>
    <div>
     <canvas id="molview" width="500" height="500" class="ui-widget-content">
      Your browser does not support the HTML5
      <code>&lt;canvas&gt;</code> element.
      <a href="http://get.webgl.org">Click here to upgrade your browser.</a>
     </canvas>
    </div>
    <hr/>
  </div>
  <div id="tabs_log">
    <p id="log">Log text</p>
  </div>
  <div id="tabs_debug">
    <pre id="debug">Debug text</pre>
  </div>
</div>
</body>
</html>
