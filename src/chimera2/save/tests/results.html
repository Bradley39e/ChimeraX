<html>
  <!-- vi:set sw=2: -->
  <head>
    <title>Sprint Results</title>
  </head>
  <body>
    <h1>Sprint Results</h1>

    <ul>
      <li>Review architecture
      <li>Tests
    </ul>

    <h2>Sprint goals:</h2>
    <h3>Sprint 1:</h3>
    <ul>
      <li>numpy 1.5.1
      <li>explore speed/space trade off of collapsing objects of the same
      type into parallal per-attribute numpy arrays
    </ul>

    <h3>Sprint 2:</h3>
    <ul>
      <li>numpy 1.5.1
      <li>auto-create array attributes (based on sprint 1 results)
      <li>renamed Part to Item
      <li>separated out selections and made them use set API
      <li>support ordered selection sets
      <li>added bulk access API
    </ul>

    <h3>Sprint 3:</h3>
    <ul>
      <li>numpy 1.6.1
      <li>figure cost of proxy objects
      <li>initial webgl display of spheres and cylinders
    </ul>

    <h2>Chimera2 Architecture</h2>

    <a href="../chimera2/index.html">chimera2 package</a>
    <p>
    The universe object holds everything (except templates).
    In the universe are groups of items.  Items hold individual objects,
    i.e., an item.  The item containers, items, follow the list API,
    but can be a different type if needed.
    <p>
    Selections can be made passed on item types and attribute values.
    Selections follow the set API.

    <h2>Test Programs</h2>

    All measures are crude &mdash; especially memory.

    <h3><a href="test1.py">Test 1</a> (sprint 1)</h3>
    Test if using numpy arrays are effective.
    <p>
    The test program selects all spheres and cylinders
    and sets all of them to the same color.
    The test results are crude, <i>i.e.</i>,
    only one pass was made,
    because we are only interested in a rough estimate
    of the relative value of various approaches.
    <p>
    <table border="1">
       <thead>
	<tr>
	  <th></th>
	  <th>3fx2
	    <br>1,386 spheres
	    <br>1,748 cylinders
	  </th>
	  <th>3k9f
	    <br>11,559 spheres
	    <br>16,612 cylinders
	  </th>
	  <th>3cc4
	    <br>99,135 spheres
	    <br>166,517 cylinders
	  </th>
	</tr>
      </thead>
      <tbody>
	<tr>
	  <td> Python Objects </td>
	  <td>
	    1X<br>
	    0.0100328922272 <br>
	    1.6 MiB
	  </td>
	  <td>
	    1X<br>
	    0.0954599380493 <br>
	    17.2 MiB
	  </td>
	  <td>
	    1X<br>
	    0.915394067764<br>
	    169 MiB
	  </td>
	</tr>
	<tr>
	  <td> Python Objects with slots </td>
	  <td>
	    1.09X</br>
	    0.00920701026917 <br>
	    0.82 MiB
	  </td>
	  <td>
	    1.2X<br>
	    0.079794883728<br>
	    9.9 MiB
	  </td>
	  <td>
	    1.1X<br>
	    0.822746992111<br>
	    98 MiB
	  </td>
	</tr>
	<tr>
	  <td>
	    Numpy arrays for radius and<br>
	    coordinates (not color)
	  </td>
	  <td>
	    0.56X<br>
	    0.0180189609528<br>
	    1.1 MiB
	  </td>
	  <td>
	    0.62X<br>
	    0.151782989502<br>
	    11.3 MiB
	  </td>
	  <td>
	    0.65X<br>
	    1.40139698982<br>
	    108 MiB
	  </td>
	</tr>
	<tr>
	  <td>
	    Numpy arrays for all attributes,<br>
	    slotted proxy objects
	  </td>
	  <td>
	    5.6X<br>
	    0.00180101394653<br>
	    0.35 MiB
	  </td>
	  <td>
	    30.8X<br>
	    0.0030951499939<br>
	    4.5 MiB
	  </td>
	  <td>
	    65.3X<br>
	    0.0140240192413<br>
	    43.3 MiB
	  </td>
	</tr>
	<tr>
	  <td>
	    Numpy arrays for all attributes,<br>
	    slotted proxy objects<br>
	    (sprint 2)
	  </td>
	  <td>
	    7.7X (+39%)<br>
	    0.00129199028015<br>
	    0.25 MiB
	  </td>
	  <td>
	    44.5X (+44%)<br>
	    0.00214695930481<br>
	    4.73 MiB
	  </td>
	  <td>
	    92.2X (+41%)<br>
	    0.00992608070374<br>
	    46.1 MiB
	  </td>
	</tr>
      </tbody>
      <tfoot>
	<tr>
	  <td></td>
	  <td colspan="3" align="center">
	    Relative speed / 20X Time / Memory
	</td>
	</tr>
      </tfoot>
    </table>

    <h3><a href="test2.py">Test 2</a> (sprint 2)</h3>
    Test directly using arrays instead of proxies during group creation
    <p>
    <table border="1">
       <thead>
	<tr>
	  <th></th>
	  <th>3fx2
	    <br>1,386 spheres
	    <br>1,748 cylinders
	  </th>
	  <th>3k9f
	    <br>11,559 spheres
	    <br>16,612 cylinders
	  </th>
	  <th>3cc4
	    <br>99,135 spheres
	    <br>166,517 cylinders
	  </th>
	</tr>
      </thead>
      <tbody>
	<tr>
	  <td> Proxy attribute access </td>
	  <td>
	    1X<br>
	    0.632051944733 <br>
	  </td>
	  <td>
	    1X<br>
	    6.18009305 <br>
	  </td>
	  <td>
	    1X<br>
	    56.5856058598 <br>
	  </td>
	</tr>
	<tr>
	  <td> Bulk attribute access </td>
	  <td>
	    1.40X<br>
	    0.4514939785 <br>
	  </td>
	  <td>
	    1.35X<br>
	    4.58926010132 <br>
	  </td>
	  <td>
	    1.35X<br>
	    42.0210011005 <br>
	  </td>
	</tr>
      </tbody>
      <tfoot>
	<tr>
	  <td></td>
	  <td colspan="3" align="center">
	    Relative speed / 1 Time
	</td>
	</tr>
      </tfoot>
    </table>

    <h3><a href="test3.py">Test 3</a> (sprint 2)</h3>
    Test speed and memory advantage of registering array attribute 
    verus a generic attribute
    <p>
    <table border="1">
       <thead>
	<tr>
	  <th></th>
	  <th>3fx2
	    <br>1,386 spheres
	    <br>1,748 cylinders
	  </th>
	  <th>3k9f
	    <br>11,559 spheres
	    <br>16,612 cylinders
	  </th>
	  <th>3cc4
	    <br>99,135 spheres
	    <br>166,517 cylinders
	  </th>
	</tr>
      </thead>
      <tbody>
	<tr>
	  <td> unregistered attribute </td>
	  <td>
	    1X<br>
	    0.384618997574 <br>
	    0 KiB
	  </td>
	  <td>
	    1X<br>
	    3.06236314774 <br>
	    172 KiB
	  </td>
	  <td>
	    1X<br>
	    26.8623850346 <br>
	    844 KiB
	  </td>
	</tr>
	<tr>
	  <td> registered attribute
	  </td>
	  <td>
	    395X<br>
	    0.000974178314209 <br>
	    132 KiB
	  </td>
	  <td>
	    1863X<br>
	    0.00164413452148 <br>
	    284 KiB
	  </td>
	  <td>
	    3390X<br>
	    0.0079231262207 <br>
	    2716 KiB
	  </td>
	</tr>
      </tbody>
      <tfoot>
	<tr>
	  <td></td>
	  <td colspan="3" align="center">
	    Relative speed / 20X Time / Memory
	</td>
	</tr>
      </tfoot>
    </table>

    <h3><a href="test4.py">Test 4</a> (sprint 2)</h3>
    Selection test &mdash; color sphere by radius
    <p>
    <table border="1">
       <thead>
	<tr>
	  <th></th>
	  <th>3fx2
	    <br>1,386 spheres
	    <br>1,748 cylinders
	  </th>
	  <th>3k9f
	    <br>11,559 spheres
	    <br>16,612 cylinders
	  </th>
	  <th>3cc4
	    <br>99,135 spheres
	    <br>166,517 cylinders
	  </th>
	</tr>
      </thead>
      <tbody>
	<tr>
	  <td> via attribute </td>
	  <td>
	    1X<br>
	    0.724498033524 <br>
	  </td>
	  <td>
	    1X<br>
	    6.02358794212 <br>
	  </td>
	  <td>
	    1X<br>
	    50.169064045 <br>
	  </td>
	</tr>
	<tr>
	  <td> via arrays </td>
	  <td>
	    1.90X<br>
	    0.381492137909 <br>
	  </td>
	  <td>
	    1.85X<br>
	    3.24862408638 <br>
	  </td>
	  <td>
	    1.88X<br>
	    26.6918108463 <br>
	  </td>
	</tr>
      </tbody>
      <tfoot>
	<tr>
	  <td></td>
	  <td colspan="3" align="center">
	    Relative speed / 20X Time
	</td>
	</tr>
      </tfoot>
    </table>

    <h3><a href="test5.py">Test 5</a> (sprint 2)</h3>
    Selection test &mdash; select sphere in zone around other sphere
    <p>
    <table border="1">
       <thead>
	<tr>
	  <th></th>
	  <th>3fx2
	    <br>1,386 spheres
	    <br>1,748 cylinders
	  </th>
	  <th>3k9f
	    <br>11,559 spheres
	    <br>16,612 cylinders
	  </th>
	  <th>3cc4
	    <br>99,135 spheres
	    <br>166,517 cylinders
	  </th>
	</tr>
      </thead>
      <tbody>
	<tr>
	  <td> via attribute </td>
	  <td>
	    1X<br>
	    0.436246871948 <br>
	  </td>
	  <td>
	    1X<br>
	    3.57793498039 <br>
	  </td>
	  <td>
	    1X<br>
	    30.282542944 <br>
	  </td>
	</tr>
	<tr>
	  <td> via arrays </td>
	  <td>
	    56.7X<br>
	    0.00769305229187 <br>
	  </td>
	  <td>
	    62.0X<br>
	    0.0576410293579 <br>
	  </td>
	  <td>
	    63.2X<br>
	    0.479429960251 <br>
	  </td>
	</tr>

	<tr>
	  <td colspan="4" align="left">
	    Sprint 3, Python Proxy
	  </td>
	</tr>
	<tr>
	  <td> via attribute </td>
	  <td>
	    1X<br>
	    0.395416021347 <br>
	  </td>
	  <td>
	    1X<br>
	    3.23118710518 <br>
	  </td>
	  <td>
	    1X<br>
	    28.3267638683 <br>
	  </td>
	</tr>
	<tr>
	  <td> via arrays </td>
	  <td>
	    238X<br>
	    0.00166201591492 <br>
	  </td>
	  <td>
	    404X<br>
	    0.00799298286438 <br>
	  </td>
	  <td>
	    450X<br>
	    0.0629122257233 <br>
	  </td>
	</tr>

	<tr>
	  <td colspan="4" align="left">
	    Sprint 3, C Proxy
	  </td>
	</tr>
	<tr>
	  <td> via attribute </td>
	  <td>
	    1X<br>
	    0.248224973679 <br>
	  </td>
	  <td>
	    1X<br>
	    2.05225300789 <br>
	  </td>
	  <td>
	    1X<br>
	    18.2109901905 <br>
	  </td>
	</tr>
	<tr>
	  <td> via arrays </td>
	  <td>
	    164X<br>
	    0.00151395797729 <br>
	  </td>
	  <td>
	    265X<br>
	    0.00773811340332 <br>
	  </td>
	  <td>
	    285X<br>
	    0.063873052597 <br>
	  </td>
	</tr>
      </tbody>
      <tfoot>
	<tr>
	  <td></td>
	  <td colspan="3" align="center">
	    Relative speed / 20X Time
	</td>
	</tr>
      </tfoot>
    </table>

    <h3><a href="test6.py">Test 6</a> (sprint 3)</h3>
    Figure out overhead of using Proxy object to get or set an attribute
    versus a normal Python object:
    <p>
    <table border="1">
       <thead>
	<tr>
	  <th></th>
	  <th>getattr
	  </th>
	  <th>setattr
	  </th>
	</tr>
      </thead>
      <tr>
	<td> Normal Python object </td>
	<td> 1X </td>
	<td> 1X </td>
      </tr>
      <tr>
	<td> Proxy object </td>
	<td> 64X slower </td>
	<td> 99X slower </td>
      </tr>
      <tr>
	<td> Proxy object in C </td>
	<td>
	  37X slower <br>
	  (1.7X better)
	</td>
	<td>
	  69X slower <br>
	  (1.4X better)
	  <br>
	</td>
      </tr>
      <tfoot>
	<tr>
	  <td></td>
	  <td colspan="3" align="center">
	    Relative speed
	</td>
	</tr>
      </tfoot>
    </table>
    <h4>WebGL demo</h4>
    <ul>
      <li>Web server integration
      <ul>
	<li>demo is integrated into web server
	<li>will want separate separate process per session
	<ul>
	  <li>wsgi application
	  <li>http://domain/chimera-app/command
	</ul>
      </ul>
      <li>Where to draw the line between front and back ends?
      <ul>
	<li>LOD in front end
	<li>need graphics data at both ends for export
      </ul>
    </ul>
  </body>
</html>
